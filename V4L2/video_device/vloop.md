---
number headings: auto, first-level 1, max 6, 1.1
---
#嵌入式 #Linux驱动开发 #V4L2 

# 1 video loopback示例

本示例依赖系统模块 `videobuf2_v4l2` 和 `videobuf2_vmalloc`

# 2 目录

```toc
```

# 3 特性与实现

运行效果：
- 左侧为图像输入进程(用户->内核，output设备)
- 右侧为图像输出进程(内核->用户，capture设备)
	![](../../Resources/vloop.gif)

## 3.1 基本特性

该示例拥有如下特性：

- 设备特性：
	1. 输出方向(内核->用户)支持的像素格式、分辨率等完全取决于输入方向(用户->内核)
	2. 在输入方向完成像素格式和分辨率等设置之前，输出方向的枚举和设置功能均无效
	3. 只支持单输出(用户->内核)，支持多输出。多输出时，每个输入帧会随机分配到单个输出设备。
	4. <font color="#c00000">单次打开只支持选定一种数据方向</font>，也就是即使是单进程中想要同时使用输入输出，必须分别打开两次设备。
	5. 当需要更改数据方向时，<font color="#c00000">必须先释放当前所有已分配的缓冲区</font>(`VIDIOC_REQBUFS` 时 `reqbufs.count=0` )

## 3.2 loopback数据流动与实现





注意：
- 不应当使用m2m框架，因为m2m为每个打开实例都提供了输入输出两个队列，而进行本驱动的跨文件句柄传输时，每个文件句柄只会有单向输出流，即只会用到其中一个队列。


